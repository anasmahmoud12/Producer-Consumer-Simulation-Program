<div class="simulation-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="main-title">Production Line Simulator</h1>
        <p class="subtitle">Producer/Consumer Queuing Network with Design Patterns</p>
        <button (click)="test()" >test</button>
      </div>
      
      <div class="header-actions">
        <!-- Connection Status -->
        <div class="connection-status" [ngClass]="{'connected': connectionStatus.includes('Connected')}">
          <span class="status-dot"></span>
          {{ connectionStatus }}
        </div>
        
        <button class="btn btn-primary" (click)="toggleStats()">
          ğŸ“Š Statistics
        </button>
        <button class="btn btn-secondary" (click)="toggleSettings()">
          âš™ï¸ Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Control Panel -->
  <div class="control-panel">
    <div class="control-actions">
      <button 
        *ngIf="!isRunning" 
        class="btn btn-success btn-lg"
        (click)="startSimulation()">
        â–¶ï¸ Start Simulation
      </button>
      
      <ng-container *ngIf="isRunning">
        <button 
          class="btn btn-warning"
          (click)="pauseSimulation()">
          {{ isPaused ? 'â–¶ï¸ Resume' : 'â¸ï¸ Pause' }}
        </button>
        <button 
          class="btn btn-danger"
          (click)="stopSimulation()">
          â¹ï¸ Stop
        </button>
      </ng-container>
      
      <button 
        class="btn btn-info"
        (click)="replaySimulation()"
        [disabled]="!statistics">
        ğŸ”„ Replay
      </button>
    </div>

    <div class="configuration-actions">
      <button 
        class="btn btn-secondary"
        (click)="addQueue()"
        [disabled]="isRunning">
        â• Add Queue
      </button>
      <button 
        class="btn btn-secondary"
        (click)="addMachine()"
        [disabled]="isRunning">
        â• Add Machine
      </button>
      <button 
        class="btn btn-secondary"
        [ngClass]="{'active': connectionMode}"
        (click)="toggleConnectionMode()"
        [disabled]="isRunning">
        ğŸ”— Connect
      </button>
      <button 
        class="btn btn-secondary"
        (click)="saveConfiguration()">
        ğŸ’¾ Save Config
      </button>
    </div>
  </div>

  <!-- Main Canvas Area -->
  <div class="canvas-container">
    <canvas 
      #canvas 
      (click)="onCanvasClick($event)"
      [ngClass]="{'connection-mode': connectionMode}">
    </canvas>
    
    <div 
      *ngIf="connectionMode" 
      class="connection-hint">
      {{ connectionStart ? 'Click destination element' : 'Click source element' }}
    </div>

    <!-- Legend -->
    <div class="legend">
      <h4>Legend</h4>
      <div class="legend-item">
        <div class="legend-icon queue"></div>
        <span>Queue (shows product count)</span>
      </div>
      <div class="legend-item">
        <div class="legend-icon machine idle"></div>
        <span>Machine (idle)</span>
      </div>
      <div class="legend-item">
        <div class="legend-icon machine processing"></div>
        <span>Machine (processing)</span>
      </div>
    </div>
  </div>

  <!-- âš ï¸ UPDATED: Use separate components -->
  <app-statistics-panel
    *ngIf="showStats"
    [statistics]="statistics"
    (close)="showStats = false">
  </app-statistics-panel>

  <app-settings-panel
    *ngIf="showSettings"
    [(simulationSpeed)]="simulationSpeed"
    [(productionRate)]="productionRate"
    [disabled]="isRunning"
    (close)="showSettings = false">
  </app-settings-panel>
</div>